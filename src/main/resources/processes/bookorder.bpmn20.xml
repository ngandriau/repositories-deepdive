<?xml version="1.0" encoding="UTF-8"?>
<definitions xmlns="http://www.omg.org/spec/BPMN/20100524/MODEL"
             targetNamespace="http://www.bpmnwithactiviti.org"
             xmlns:activiti="http://activiti.org/bpmn">

    <process id="bookorder" name="bookorder">
        <startEvent id="startevent1" name="Start"/>

        <!--<serviceTask id="newOrder" name="new order" activiti:async="true"-->
                    <!--activiti:expression="${orderService.newOrder(customerLastname)}" />-->

        <serviceTask id="newOrder" name="newOrder" activiti:async="true" activiti:expression="${bookOrderProcessService.newOrder(execution, 'GANDRIAU')}" />

        <sequenceFlow id="sequenceflow1" name="Validate order" sourceRef="startevent1" targetRef="newOrder"/>

        <userTask id="usertask1" name="Complete order" activiti:candidateGroups="sales">
            <documentation>book order user task</documentation>
        </userTask>

        <sequenceFlow id="sequenceflow2" name="Sending to management" sourceRef="newOrder" targetRef="usertask1"/>

        <serviceTask id="scripttask2" activiti:async="true"
                     activiti:expression="${printer.sayHello('from scripttask2')}" />

        <sequenceFlow id="sequenceflow3" name="flow" sourceRef="usertask1" targetRef="scripttask2"/>

        <serviceTask id="scripttask3" activiti:async="true"
                     activiti:expression="${printer.sayHello('from scripttask3')}" />

        <sequenceFlow id="sequenceflow4" name="flow" sourceRef="scripttask2" targetRef="scripttask3"/>

        <scriptTask id="dummyEndTask" name="dummyEndTask" scriptFormat="groovy">
            <script>
                out:print "dummy end task  for isbn " + isbn + "\n";
            </script>
        </scriptTask>

        <sequenceFlow id="sequenceflow_task3_to_dummyEndTask" name="flow" sourceRef="scripttask3" targetRef="dummyEndTask"/>

        <endEvent id="endevent1" name="End"/>

        <sequenceFlow id="finalflow" name="flow" sourceRef="dummyEndTask" targetRef="endevent1"/>

    </process>
</definitions>